# Configuration Apache pour PHP et HTML
# Placez ce fichier dans le répertoire racine du site

# Permettre l'exécution de PHP dans les fichiers .html
AddType application/x-httpd-php .html .htm

RewriteEngine On

# Redirection des URLs sans extension vers PHP si le fichier existe
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{DOCUMENT_ROOT}/$1.php -f
RewriteRule ^([^/]+)/?$ $1.php [L]

# Redirection des URLs de catalogue vers PHP
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{DOCUMENT_ROOT}/catalogue-femme/$1.php -f
RewriteRule ^catalogue-femme/([^/]+)/?$ catalogue-femme/$1.php [L]

RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{DOCUMENT_ROOT}/catalogue-homme/$1.php -f
RewriteRule ^catalogue-homme/([^/]+)/?$ catalogue-homme/$1.php [L]

RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{DOCUMENT_ROOT}/costumes/$1.php -f
RewriteRule ^costumes/([^/]+)/?$ costumes/$1.php [L]

# Cache pour les ressources statiques
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType image/webp "access plus 1 month"
    ExpiresByType image/jpg "access plus 1 month"
    ExpiresByType image/jpeg "access plus 1 month"
    ExpiresByType image/png "access plus 1 month"
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
    ExpiresByType application/pdf "access plus 1 month"
</IfModule>

# Compression Gzip
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/xml
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE application/xml
    AddOutputFilterByType DEFLATE application/xhtml+xml
    AddOutputFilterByType DEFLATE application/rss+xml
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/x-javascript
</IfModule>

# Sécurité - Masquer les fichiers sensibles
<Files "*.php">
    <IfModule mod_rewrite.c>
        RewriteEngine On
        # Autoriser l'accès aux pages PHP publiques
        RewriteCond %{REQUEST_URI} !^/(includes|migrate_to_php\.php)
        RewriteRule . - [L]
    </IfModule>
</Files>

# Bloquer l'accès aux fichiers includes
<Directory "includes/">
    Require all denied
</Directory>

# Bloquer l'accès au script de migration
<Files "migrate_to_php.php">
    Require all denied
</Files>

# Redirection d'erreur personnalisée
ErrorDocument 404 /index.html
